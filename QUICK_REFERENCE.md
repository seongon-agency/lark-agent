# Quick Reference Card

## Essential Commands

### Railway CLI

```bash
# Login
railway login

# Deploy
railway up

# Set environment variable
railway variables set KEY=value

# View logs
railway logs
railway logs --service feishu-bot
railway logs --service agno-service

# Check status
railway status

# Open dashboard
railway open
```

### Docker Compose

```bash
# Start services
docker-compose up -d

# Stop services
docker-compose down

# View logs
docker-compose logs -f
docker-compose logs -f feishu-bot
docker-compose logs -f agno-service

# Restart services
docker-compose restart

# Rebuild and restart
docker-compose up -d --build
```

### Health Checks

```bash
# Local
curl http://localhost:9000/ping
curl http://localhost:8000/health

# Railway (replace with your URLs)
curl https://feishu-bot-production.up.railway.app/ping
curl https://agno-service-production.up.railway.app/health
```

### Verification Scripts

```bash
# Linux/Mac
bash verify-deployment.sh

# Windows PowerShell
.\verify-deployment.ps1

# With custom URLs
export FEISHU_BOT_URL=https://your-bot.up.railway.app
export AGNO_SERVICE_URL=https://your-agno.up.railway.app
bash verify-deployment.sh
```

## Environment Variables

### Required - Feishu Bot

```env
APP_ID=cli_your_app_id
APP_SECRET=your_app_secret
APP_ENCRYPT_KEY=your_encrypt_key
APP_VERIFICATION_TOKEN=your_token
OPENAI_KEY=sk-your_key
AGNO_SERVICE_URL=http://agno-service.railway.internal:8000
```

### Required - Agno Service

```env
OPENAI_KEY=sk-your_key
OPENAI_MODEL=gpt-4
```

## Railway Service URLs

### Internal Communication (Service-to-Service)
```
http://agno-service.railway.internal:8000
http://feishu-bot.railway.internal:9000
```

### Public URLs (Generated by Railway)
```
https://feishu-bot-production.up.railway.app
https://agno-service-production.up.railway.app
```

## Feishu Webhook URLs

```
Event Callback:  https://your-domain.up.railway.app/webhook/event
Card Callback:   https://your-domain.up.railway.app/webhook/card
Health Check:    https://your-domain.up.railway.app/ping
```

## Common Tasks

### Update Configuration

```bash
# 1. Edit .env or update Railway variables
# 2. Commit and push (Railway auto-deploys)
git add .
git commit -m "Update config"
git push

# Or redeploy manually in Railway dashboard
```

### View Logs

```bash
# Railway - Real-time
railway logs --follow

# Railway - Specific service
railway logs --service agno-service --follow

# Docker - Real-time
docker-compose logs -f

# Docker - Last 100 lines
docker-compose logs --tail=100
```

### Restart Services

```bash
# Railway (via CLI)
railway restart

# Railway (via dashboard)
# Dashboard → Service → Deployments → Redeploy

# Docker Compose
docker-compose restart
```

### Clear Bot Memory

```
# In Feishu, send to bot:
/clear
```

## File Locations

```
Root
├── railway.json                # Railway root config
├── .env.example                # Env template
├── docker-compose.yaml         # Multi-service config
├── Dockerfile                  # Go bot image
│
├── code/                       # Go bot source
│   └── initialization/config.go  # Config loader
│
└── ai-service/                 # Python AI service
    ├── railway.json            # Railway Python config
    ├── Dockerfile              # Python image
    ├── main.py                 # FastAPI app
    └── requirements.txt        # Dependencies
```

## Documentation Map

```
GETTING_STARTED.md         → Start here
RAILWAY_QUICKSTART.md      → 15-min deployment
RAILWAY_DEPLOYMENT.md      → Complete guide
DEPLOYMENT_CHECKLIST.md    → Pre-deploy checklist
CLAUDE.md                  → Architecture details
RAILWAY_READY.md          → Configuration summary
QUICK_REFERENCE.md        → This file
```

## Troubleshooting

| Issue | Quick Fix |
|-------|-----------|
| Bot not responding | Check logs: `railway logs` |
| OpenAI error | Verify API key: `railway variables` |
| Webhook fails | Check APP_ENCRYPT_KEY matches Feishu |
| Services can't talk | Use `.railway.internal` URL |
| Port conflict (local) | Change ports in docker-compose.yaml |

## Testing Endpoints

### Local
```bash
# Feishu bot health
curl http://localhost:9000/ping

# Agno service health
curl http://localhost:8000/health

# Test chat endpoint
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"session_id":"test","message":"Hello"}'
```

### Railway
```bash
# Replace YOUR_DOMAIN with actual Railway domain

# Feishu bot
curl https://YOUR_DOMAIN.up.railway.app/ping

# Agno service (if public)
curl https://YOUR_AGNO_DOMAIN.up.railway.app/health

# Test chat
curl -X POST https://YOUR_AGNO_DOMAIN.up.railway.app/chat \
  -H "Content-Type: application/json" \
  -d '{"session_id":"test","message":"Hello"}'
```

## Port Configuration

| Service | Local | Railway | Purpose |
|---------|-------|---------|---------|
| Feishu Bot | 9000 | Dynamic ($PORT) | Webhook handler |
| Agno Service | 8000 | Dynamic ($PORT) | AI backend |

## Git Workflow

```bash
# Make changes
git add .
git commit -m "Your message"
git push origin main

# Railway auto-deploys on push to main branch

# Check deployment status
railway status
```

## Emergency Rollback

```bash
# Railway Dashboard
# → Deployments → Select previous deployment → Redeploy

# Or via CLI (if available)
railway rollback
```

## Cost Monitoring

```bash
# Railway Dashboard
# → Project → Usage tab

# View current usage
# Set billing alerts
```

## Support Links

- Railway: https://railway.app/dashboard
- Feishu: https://open.feishu.cn/app
- OpenAI: https://platform.openai.com
- Docs: See RAILWAY_DEPLOYMENT.md

---

**Print this page for quick reference during deployment!**
